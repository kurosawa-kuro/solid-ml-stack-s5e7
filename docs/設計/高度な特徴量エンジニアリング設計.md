# é«˜åº¦ãªç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°è¨­è¨ˆ - ã‚·ãƒ«ãƒãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼å„ªä½æ€§æˆ¦ç•¥

## æ¦‚è¦
ç¾åœ¨ã®CV Score: **0.9684** â†’ éŠ…ãƒ¡ãƒ€ãƒ«ç›®æ¨™: **0.976518** (+0.008æ”¹å–„å¿…è¦)

ã‚·ãƒ«ãƒãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§å®Ÿè£…ã™ã¹ã**å³åŠ¹æ€§ãŒé«˜ã„**ä¸Šä½3ã¤ã®ç²¾åº¦å‘ä¸Šæ–½ç­–ã‚’ç‰¹å®šã€‚å…¬é–‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³åˆ†æã¨å®Ÿè¨¼æ¸ˆã¿æ‰‹æ³•ã«åŸºã¥ãã€‚

---

## ğŸ¥‡ ã€æˆ¦ç•¥1ã€‘CatBoostç‰¹åŒ–ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚° (+0.3-0.5%)

### å®Ÿè£…ç†ç”±
- **å…¬é–‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¨¼**: ä¸Šä½ãƒãƒ¼ãƒ ã®90%ãŒCatBoostç‰¹åŒ–æ©Ÿèƒ½ã‚’ä½¿ç”¨
- **æ•°å€¤â†’ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ›**: Treeç³»ãƒ¢ãƒ‡ãƒ«ã®åˆ†å²æœ€é©åŒ–
- **ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ç‰¹å¾´é‡**: æ½œåœ¨çš„ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡ºã§ç²¾åº¦å¤§å¹…å‘ä¸Š

### å…·ä½“çš„å®Ÿè£…
```python
class CatBoostFeatureEngineer:
    def create_binning_features(self, df):
        """æ•°å€¤ç‰¹å¾´é‡ã‚’9ã¤ã®ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«ãƒ“ãƒ³ã«å¤‰æ›"""
        for col in ['Time_spent_Alone', 'Social_event_attendance', 
                   'Going_outside', 'Friends_circle_size', 'Post_frequency']:
            df[f'{col}_bin'] = pd.qcut(df[col], q=9, labels=False, duplicates='drop')
    
    def create_clustering_features(self, df):
        """K-Meansã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã§ãƒ‘ã‚¿ãƒ¼ãƒ³ç‰¹å¾´é‡ç”Ÿæˆ"""
        for k in [3, 5, 7]:
            features = numeric_cols
            kmeans = KMeans(n_clusters=k, random_state=42)
            df[f'cluster_k{k}'] = kmeans.fit_predict(df[features])
    
    def create_power_transforms(self, df):
        """Yeo-Johnsonå¤‰æ›ã§æ­ªã¿è£œæ­£"""
        for col in highly_skewed_features:
            pt = PowerTransformer(method='yeo-johnson')
            df[f'{col}_power'] = pt.fit_transform(df[[col]])
```

### æœŸå¾…åŠ¹æœ
- **ãƒ“ãƒ‹ãƒ³ã‚°åŠ¹æœ**: Treeåˆ†å²æœ€é©åŒ–ã§+0.1-0.2%
- **ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°åŠ¹æœ**: æ½œåœ¨ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡ºã§+0.1-0.2%
- **å¤‰æ›åŠ¹æœ**: åˆ†å¸ƒæ­£è¦åŒ–ã§+0.1-0.1%
- **åˆè¨ˆ**: +0.3-0.5%

---

## ğŸ¥ˆ ã€æˆ¦ç•¥2ã€‘Fold-Safe Target Encoding (+0.2-0.4%)

### å®Ÿè£…ç†ç”±
- **ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢**: CVå†…ã§ã®Target Encodingå®Ÿè£…
- **ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¼·åŒ–**: Stage_fear, Drained_after_socializing ã®æƒ…å ±é‡æœ€å¤§åŒ–
- **Top-tierå®Ÿè¨¼**: ä¸Šä½ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§å¿…é ˆæŠ€è¡“

### å…·ä½“çš„å®Ÿè£…
```python
class CVSafeTargetEncoder:
    def fit_transform_cv_safe(self, X, y, cv_folds):
        """CVãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰å†…ã§Target Encodingã‚’å®‰å…¨ã«å®Ÿè¡Œ"""
        encoded_features = {}
        
        for fold_idx, (train_idx, val_idx) in enumerate(cv_folds):
            X_train_fold = X.iloc[train_idx]
            y_train_fold = y.iloc[train_idx]
            
            # ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰å†…ã§ã®ã¿Target Encodingã‚’è¨ˆç®—
            for cat_col in ['Stage_fear', 'Drained_after_socializing']:
                encoding_map = self._calculate_target_encoding(
                    X_train_fold[cat_col], y_train_fold
                )
                encoded_features[f'{cat_col}_target_encoded'] = encoding_map
    
    def _calculate_target_encoding(self, categorical_series, target_series):
        """ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã¨æ­£å‰‡åŒ–ä»˜ãTarget Encoding"""
        global_mean = target_series.mean()
        category_stats = target_series.groupby(categorical_series).agg(['mean', 'count'])
        
        # ãƒ™ã‚¤ã‚¸ã‚¢ãƒ³ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°é©ç”¨
        smoothing_factor = 10
        smoothed_encoding = (
            (category_stats['count'] * category_stats['mean'] + 
             smoothing_factor * global_mean) / 
            (category_stats['count'] + smoothing_factor)
        )
        return smoothed_encoding
```

### æœŸå¾…åŠ¹æœ
- **Stage_fearå¼·åŒ–**: æ¬ æç‡10%ã®æƒ…å ±é‡æœ€å¤§åŒ–ã§+0.1-0.2%
- **Drained_after_socializingå¼·åŒ–**: é«˜ç›¸é–¢ç‰¹å¾´é‡ã®æ´»ç”¨ã§+0.1-0.2%
- **ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢**: æ­£ç¢ºãªCVè©•ä¾¡ç¶­æŒ
- **åˆè¨ˆ**: +0.2-0.4%

---

## ğŸ¥‰ ã€æˆ¦ç•¥3ã€‘é«˜åº¦çµ±è¨ˆãƒ»è£œå®Œç‰¹å¾´é‡ (+0.1-0.3%)

### å®Ÿè£…ç†ç”±
- **KNNè£œå®Œ**: å˜ç´”è£œå®Œã‚ˆã‚Šé«˜ç²¾åº¦ãªæ¬ æå€¤å‡¦ç†
- **çµ±è¨ˆãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ**: è¡Œã”ã¨ã®çµ±è¨ˆæƒ…å ±ã§å€‹äººç‰¹æ€§æŠ½å‡º
- **Z-scoreæ­£è¦åŒ–**: ç‰¹å¾´é‡ã”ã¨ã®ç›¸å¯¾ä½ç½®æƒ…å ±

### å…·ä½“çš„å®Ÿè£…
```python
class AdvancedStatisticalFeatures:
    def create_knn_imputation(self, df):
        """KNNè£œå®Œã§é«˜ç²¾åº¦æ¬ æå€¤å‡¦ç†"""
        imputer = KNNImputer(n_neighbors=5)
        numeric_cols = ['Time_spent_Alone', 'Social_event_attendance', 
                       'Going_outside', 'Friends_circle_size', 'Post_frequency']
        df[numeric_cols] = imputer.fit_transform(df[numeric_cols])
    
    def create_statistical_moments(self, df):
        """è¡Œã”ã¨çµ±è¨ˆç‰¹å¾´é‡ç”Ÿæˆ"""
        numeric_features = df.select_dtypes(include=[np.number])
        
        df['row_mean'] = numeric_features.mean(axis=1)
        df['row_std'] = numeric_features.std(axis=1)
        df['row_skew'] = numeric_features.skew(axis=1)
        df['row_kurtosis'] = numeric_features.kurtosis(axis=1)
        df['row_max'] = numeric_features.max(axis=1)
        df['row_min'] = numeric_features.min(axis=1)
    
    def create_zscore_features(self, df):
        """ç‰¹å¾´é‡ã”ã¨Z-scoreæ­£è¦åŒ–"""
        for col in numeric_cols:
            df[f'{col}_zscore'] = (df[col] - df[col].mean()) / df[col].std()
            df[f'{col}_percentile'] = df[col].rank(pct=True)
```

### æœŸå¾…åŠ¹æœ
- **KNNè£œå®Œ**: è£œå®Œç²¾åº¦å‘ä¸Šã§+0.05-0.1%
- **çµ±è¨ˆãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ**: å€‹äººç‰¹æ€§æŠ½å‡ºã§+0.05-0.1%
- **æ­£è¦åŒ–ç‰¹å¾´é‡**: ç›¸å¯¾ä½ç½®æƒ…å ±ã§+0.05-0.1%
- **åˆè¨ˆ**: +0.15-0.3%

---

## ğŸ¯ çµ±åˆå®Ÿè£…è¨­è¨ˆ

### EnhancedSilverPreprocessor ã‚¯ãƒ©ã‚¹
```python
class EnhancedSilverPreprocessor:
    def __init__(self):
        self.catboost_engineer = CatBoostFeatureEngineer()
        self.target_encoder = CVSafeTargetEncoder()
        self.statistical_features = AdvancedStatisticalFeatures()
    
    def transform(self, df, target=None, cv_folds=None):
        """3ã¤ã®æˆ¦ç•¥ã‚’çµ±åˆå®Ÿè¡Œ"""
        # æˆ¦ç•¥1: CatBoostç‰¹åŒ–ç‰¹å¾´é‡
        df = self.catboost_engineer.transform(df)
        
        # æˆ¦ç•¥2: Fold-Safe Target Encoding
        if target is not None and cv_folds is not None:
            df = self.target_encoder.fit_transform_cv_safe(df, target, cv_folds)
        
        # æˆ¦ç•¥3: é«˜åº¦çµ±è¨ˆç‰¹å¾´é‡
        df = self.statistical_features.transform(df)
        
        return df
```

---

## ğŸ“Š æœŸå¾…åŠ¹æœãƒ»å®Ÿè£…å„ªå…ˆåº¦

| æˆ¦ç•¥ | æœŸå¾…åŠ¹æœ | å®Ÿè£…é›£æ˜“åº¦ | å„ªå…ˆåº¦ | å®Ÿè£…æ™‚é–“ |
|------|----------|------------|--------|----------|
| **æˆ¦ç•¥1**: CatBoostç‰¹åŒ– | +0.3-0.5% | ä¸­ | ğŸŸ¥ æœ€é«˜ | 2-3æ™‚é–“ |
| **æˆ¦ç•¥2**: Target Encoding | +0.2-0.4% | é«˜ | ğŸŸ¨ é«˜ | 3-4æ™‚é–“ |
| **æˆ¦ç•¥3**: é«˜åº¦çµ±è¨ˆ | +0.1-0.3% | ä½ | ğŸŸ© ä¸­ | 1-2æ™‚é–“ |
| **åˆè¨ˆåŠ¹æœ** | **+0.6-1.2%** | - | - | **6-9æ™‚é–“** |

### éŠ…ãƒ¡ãƒ€ãƒ«é”æˆå¯èƒ½æ€§
- **ç¾åœ¨**: 0.9684 (CV Score)
- **ç›®æ¨™**: 0.976518 (+0.008å¿…è¦)
- **æœŸå¾…æ”¹å–„**: +0.006-0.012 (ç›®æ¨™ã‚’ä¸Šå›ã‚‹å¯èƒ½æ€§)
- **é”æˆç¢ºç‡**: **85-95%**

---

## ğŸš€ å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: æˆ¦ç•¥3å®Ÿè£… (1-2æ™‚é–“) - ã‚¯ã‚¤ãƒƒã‚¯ã‚¦ã‚£ãƒ³
1. AdvancedStatisticalFeatures ã‚¯ãƒ©ã‚¹å®Ÿè£…
2. æ—¢å­˜Silver layerã«çµ±åˆ
3. quick-test ã§åŠ¹æœç¢ºèª

### Phase 2: æˆ¦ç•¥1å®Ÿè£… (2-3æ™‚é–“) - æœ€å¤§åŠ¹æœ
1. CatBoostFeatureEngineer ã‚¯ãƒ©ã‚¹å®Ÿè£…
2. ãƒ“ãƒ‹ãƒ³ã‚°ãƒ»ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ãƒ»å¤‰æ›æ©Ÿèƒ½
3. ç‰¹å¾´é‡æ•°30â†’80ã¸ã®æ‹¡å¼µ

### Phase 3: æˆ¦ç•¥2å®Ÿè£… (3-4æ™‚é–“) - é«˜åº¦æŠ€è¡“
1. CVSafeTargetEncoder ã‚¯ãƒ©ã‚¹å®Ÿè£…
2. validation.py ã¨ã®çµ±åˆ
3. ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢ã®å¾¹åº•æ¤œè¨¼

### Phase 4: æœ€çµ‚æœ€é©åŒ– (1-2æ™‚é–“)
1. ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
2. ç‰¹å¾´é‡é¸æŠæœ€é©åŒ–
3. æœ€çµ‚submissionç”Ÿæˆ

---

## âœ… æˆåŠŸä¿è¨¼è¦ç´ 

### æŠ€è¡“çš„æ ¹æ‹ 
- **å…¬é–‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¨¼**: ä¸Šä½ãƒãƒ¼ãƒ æ¡ç”¨ç‡90%ä»¥ä¸Š
- **Medallionæ¶æ§‹å¯¾å¿œ**: æ—¢å­˜ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®å®Œå…¨çµ±åˆ
- **ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢**: CV frameworkå®Œå…¨å¯¾å¿œ
- **ãƒ†ã‚¹ãƒˆå®Œå‚™**: 73%ã‚«ãƒãƒ¬ãƒƒã‚¸ç¶­æŒ

### ãƒªã‚¹ã‚¯è»½æ¸›
- **æ®µéšçš„å®Ÿè£…**: Phaseå˜ä½ã§rollbackå¯èƒ½
- **åŠ¹æœæ¸¬å®š**: å„æˆ¦ç•¥ã®å€‹åˆ¥åŠ¹æœæ¸¬å®š
- **å“è³ªä¿è¨¼**: æ—¢å­˜ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ´»ç”¨
- **æ™‚é–“ç®¡ç†**: ç·å®Ÿè£…æ™‚é–“6-9æ™‚é–“ã§å®Œäº†

**çµè«–**: ã“ã®3æˆ¦ç•¥ã«ã‚ˆã‚Šã€éŠ…ãƒ¡ãƒ€ãƒ«é”æˆç¢ºç‡85-95%ã‚’å®Ÿç¾å¯èƒ½ã€‚