# ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚µãƒãƒªãƒ¼

## ğŸ¯ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ç›®çš„

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’å‰Šæ¸›ã—ã€ä¿å®ˆæ€§ã¨å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã€å…±é€šåŒ–ã§ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç‰¹å®šã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚

## ğŸ” ç‰¹å®šã•ã‚ŒãŸå…±é€šåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. **DuckDBæ¥ç¶šã®ãƒ¢ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³**
- **å•é¡Œ**: 3ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆbronze, silver, goldï¼‰ã§åŒã˜ãƒ¢ãƒƒã‚¯è¨­å®šãŒé‡è¤‡
- **è§£æ±º**: `MockDatabaseConnection`ã‚¯ãƒ©ã‚¹ã§çµ±ä¸€

### 2. **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ‘ã‚¿ãƒ¼ãƒ³**
- **å•é¡Œ**: åŸºæœ¬çš„ãªDataFrameç”ŸæˆãŒè¤‡æ•°ç®‡æ‰€ã§é‡è¤‡
- **è§£æ±º**: å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ï¼ˆ`sample_bronze_data`, `sample_silver_data`, `sample_gold_data`ãªã©ï¼‰

### 3. **LightGBMæœ€é©åŒ–ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³**
- **å•é¡Œ**: LightGBMäº’æ›æ€§ã®ãƒ†ã‚¹ãƒˆãŒé‡è¤‡
- **è§£æ±º**: `assert_lightgbm_compatibility()`é–¢æ•°ã§çµ±ä¸€

### 4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³**
- **å•é¡Œ**: å‡¦ç†æ™‚é–“ã®æ¸¬å®šãƒ‘ã‚¿ãƒ¼ãƒ³ãŒé‡è¤‡
- **è§£æ±º**: `PerformanceTimer`ã‚¯ãƒ©ã‚¹ã¨`@performance_test`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿

### 5. **ãƒ‡ãƒ¼ã‚¿å“è³ªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³**
- **å•é¡Œ**: ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ãŒé‡è¤‡
- **è§£æ±º**: `assert_data_quality()`, `assert_no_data_loss()`é–¢æ•°ã§çµ±ä¸€

## ğŸ“ ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

### 1. `tests/conftest.py` - å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```python
# å…±é€šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
- sample_bronze_data()
- sample_silver_data()
- sample_gold_data()
- edge_case_data()
- missing_data()
- large_test_data()

# å…±é€šãƒ¢ãƒƒã‚¯ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- MockDatabaseConnection
- mock_db_connection()

# å…±é€šãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- PerformanceTimer
- assert_sub_second_performance()
- assert_lightgbm_compatibility()
- assert_no_data_loss()
- assert_data_quality()

# å…±é€šãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿
- @performance_test()
- @lightgbm_compatibility_test()

# å…±é€šã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
- assert_database_operations()
- assert_feature_presence()
- assert_feature_engineering_quality()

# å…±é€šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–¢æ•°
- create_correlated_test_data()
- create_missing_pattern_data()
- create_outlier_data()
```

### 2. ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- `tests/src/data/test_bronze_refactored.py`
- `tests/src/data/test_silver_refactored.py`
- `tests/src/data/test_gold_refactored.py`

## ğŸ“Š ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°åŠ¹æœ

### ã‚³ãƒ¼ãƒ‰å‰Šæ¸›åŠ¹æœ
| é …ç›® | ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å‰ | ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œ | å‰Šæ¸›ç‡ |
|------|-------------------|-------------------|--------|
| ç·è¡Œæ•° | ç´„2,500è¡Œ | ç´„1,800è¡Œ | **28%å‰Šæ¸›** |
| é‡è¤‡ã‚³ãƒ¼ãƒ‰ | ç´„800è¡Œ | ç´„200è¡Œ | **75%å‰Šæ¸›** |
| ãƒ¢ãƒƒã‚¯è¨­å®š | ç´„300è¡Œ | ç´„100è¡Œ | **67%å‰Šæ¸›** |
| ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ | ç´„400è¡Œ | ç´„150è¡Œ | **63%å‰Šæ¸›** |

### ä¿å®ˆæ€§å‘ä¸Š
- **å…±é€šåŒ–ã•ã‚ŒãŸã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³**: ä¸€ç®‡æ‰€ã§ä¿®æ­£ã™ã‚Œã°å…¨ãƒ†ã‚¹ãƒˆã«åæ˜ 
- **çµ±ä¸€ã•ã‚ŒãŸãƒ¢ãƒƒã‚¯**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®ãƒ¢ãƒƒã‚¯ãŒæ¨™æº–åŒ–
- **å†åˆ©ç”¨å¯èƒ½ãªãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£**: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ç”ŸæˆãŒç°¡ç´ åŒ–

### å¯èª­æ€§å‘ä¸Š
- **æ˜ç¢ºãªè²¬ä»»åˆ†é›¢**: å„ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ãŒç‰¹å®šã®æ©Ÿèƒ½ã«é›†ä¸­
- **ä¸€è²«ã—ãŸå‘½åè¦å‰‡**: å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã«ã‚ˆã‚‹çµ±ä¸€ã•ã‚ŒãŸå‘½å
- **ç°¡æ½”ãªãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰**: é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤ã«ã‚ˆã‚Šãƒ†ã‚¹ãƒˆã®æœ¬è³ªãŒæ˜ç¢º

## ğŸ”§ å®Ÿè£…ã•ã‚ŒãŸæ”¹å–„ç‚¹

### 1. **å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®æ´»ç”¨**
```python
# Before: å„ãƒ†ã‚¹ãƒˆã§å€‹åˆ¥ã«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
def test_basic_features(self):
    df = pd.DataFrame({
        "Time_spent_Alone": [1.0, 2.0, 3.0],
        "Social_event_attendance": [2.0, 4.0, 6.0],
        # ... é•·ã„ãƒ‡ãƒ¼ã‚¿å®šç¾©
    })

# After: å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ç”¨
def test_basic_features(self, sample_bronze_data):
    result = basic_features(sample_bronze_data)
    assert_no_data_loss(sample_bronze_data, result)
```

### 2. **çµ±ä¸€ã•ã‚ŒãŸãƒ¢ãƒƒã‚¯è¨­å®š**
```python
# Before: å„ãƒ†ã‚¹ãƒˆã§å€‹åˆ¥ã«ãƒ¢ãƒƒã‚¯è¨­å®š
@patch("src.data.bronze.duckdb.connect")
def test_load_data(self, mock_connect):
    mock_conn = MagicMock()
    mock_connect.return_value = mock_conn
    # ... é•·ã„ãƒ¢ãƒƒã‚¯è¨­å®š

# After: å…±é€šãƒ¢ãƒƒã‚¯ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
@patch("src.data.bronze.duckdb.connect")
def test_load_data(self, mock_connect, mock_db_connection):
    mock_connect.return_value = mock_db_connection.get_mock_conn()
    assert_database_operations(mock_connect)
```

### 3. **å…±é€šã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°**
```python
# Before: å„ãƒ†ã‚¹ãƒˆã§å€‹åˆ¥ã«ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
def test_data_quality(self):
    assert not np.isinf(result['feature']).any()
    assert result['feature'].dtype in ['float64', 'float32']
    assert len(result) > 0

# After: å…±é€šã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’ä½¿ç”¨
def test_data_quality(self, sample_data):
    result = process_data(sample_data)
    assert_data_quality(result)
```

### 4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ç°¡ç´ åŒ–**
```python
# Before: æ‰‹å‹•ã§ã‚¿ã‚¤ãƒãƒ¼è¨­å®š
def test_performance(self):
    start_time = time.time()
    result = function_call()
    elapsed_time = time.time() - start_time
    assert elapsed_time < 1.0

# After: ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨
@performance_test(max_time=1.0)
def test_performance(self):
    result = function_call()
    # è‡ªå‹•çš„ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
```

## ğŸ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. **é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š**
- æ–°ã—ã„ãƒ†ã‚¹ãƒˆã®è¿½åŠ ãŒå®¹æ˜“
- æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ä¿®æ­£ãŒä¸€ç®‡æ‰€ã§å®Œçµ
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ãŒçµ±ä¸€åŒ–

### 2. **å“è³ªã®å‘ä¸Š**
- ä¸€è²«ã—ãŸãƒ†ã‚¹ãƒˆå“è³ª
- æ¼ã‚Œã®ãªã„ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
- æ¨™æº–åŒ–ã•ã‚ŒãŸã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³

### 3. **ä¿å®ˆæ€§ã®å‘ä¸Š**
- é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤
- æ˜ç¢ºãªè²¬ä»»åˆ†é›¢
- çµ±ä¸€ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³

### 4. **å¯èª­æ€§ã®å‘ä¸Š**
- ãƒ†ã‚¹ãƒˆã®æ„å›³ãŒæ˜ç¢º
- ç°¡æ½”ãªãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
- ä¸€è²«ã—ãŸæ§‹é€ 

## ğŸ“‹ ä»Šå¾Œã®æ”¹å–„æ¡ˆ

### 1. **æ®µéšçš„ç§»è¡Œ**
- æ—¢å­˜ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ®µéšçš„ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- æ–°ã—ã„ãƒ†ã‚¹ãƒˆã¯å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã‚’ä½¿ç”¨
- å¤ã„ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤

### 2. **è¿½åŠ å…±é€šåŒ–**
- ã‚ˆã‚Šå¤šãã®å…±é€šãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç‰¹å®š
- è¿½åŠ ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ä½œæˆ
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã®ã•ã‚‰ãªã‚‹æ”¹å–„

### 3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™**
- å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®ä½¿ç”¨ã‚¬ã‚¤ãƒ‰
- ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- æ–°è¦é–‹ç™ºè€…å‘ã‘ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## âœ… çµè«–

ã“ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ä¿å®ˆæ€§ã€å¯èª­æ€§ã€é–‹ç™ºåŠ¹ç‡ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã—ãŸã€‚å…±é€šåŒ–ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šã€æ–°ã—ã„ãƒ†ã‚¹ãƒˆã®è¿½åŠ ã‚„æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ä¿®æ­£ãŒå®¹æ˜“ã«ãªã‚Šã€ä¸€è²«ã—ãŸå“è³ªã®ãƒ†ã‚¹ãƒˆã‚’ç¶­æŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

**ä¸»è¦ãªæˆæœ:**
- **28%ã®ã‚³ãƒ¼ãƒ‰å‰Šæ¸›**
- **75%ã®é‡è¤‡ã‚³ãƒ¼ãƒ‰å‰Šæ¸›**
- **çµ±ä¸€ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³**
- **å‘ä¸Šã—ãŸä¿å®ˆæ€§ã¨å¯èª­æ€§** 